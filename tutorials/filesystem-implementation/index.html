<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="OS Lab website for NIT Calicut"><link href=https://exposnitc.github.io/expos-docs/tutorials/filesystem-implementation/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.2.1, mkdocs-material-7.1.10"><title>eXpOS File system and Implementation Tutorial - eXpOS NITC</title><link rel=stylesheet href=../../assets/stylesheets/main.1fe995fd.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.f1a3b89f.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#disk-data-structures class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-announce> <div class="md-announce__inner md-grid md-typeset"> <b>Site is undergoing migration.</b> Old URL: <a href=http://eXpOSNitc.github.io/Tutorials/filesystem_implementation.html target=_blank rel="nofollow noopener">http://eXpOSNitc.github.io/Tutorials/filesystem_implementation.html</a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="eXpOS NITC" class="md-header__button md-logo" aria-label="eXpOS NITC" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> eXpOS NITC </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> eXpOS File system and Implementation Tutorial </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/eXpOSNitc/expos-docs/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eXpOSNitc/expos-docs </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../documentation/ class="md-tabs__link md-tabs__link--active"> Documentation </a> </li> <li class=md-tabs__item> <a href=../../roadmap/ class=md-tabs__link> Roadmap </a> </li> <li class=md-tabs__item> <a href=../../faq/ class=md-tabs__link> FAQ </a> </li> <li class=md-tabs__item> <a href=../../feedback/ class=md-tabs__link> Student Feedback </a> </li> <li class=md-tabs__item> <a href=https://exposnitc.github.io/user-contrib/ target=_blank class=md-tabs__link> User Contributions </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=http://xosnitc.github.io target=_blank class=md-tabs__link> XOS </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="eXpOS NITC" class="md-nav__button md-logo" aria-label="eXpOS NITC" data-md-component=logo> <img src=../../assets/logo.png alt=logo> </a> eXpOS NITC </label> <div class=md-nav__source> <a href=https://github.com/eXpOSNitc/expos-docs/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> eXpOSNitc/expos-docs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Documentation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Documentation data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../documentation/ class=md-nav__link> Documentation </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Operating System <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Operating System" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Operating System </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_1 type=checkbox id=__nav_2_2_1> <label class=md-nav__link for=__nav_2_2_1> Specification <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Specification data-md-level=3> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> Specification </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../os-spec/ class=md-nav__link> Specification </a> </li> <li class=md-nav__item> <a href=../../os-spec/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../os-spec/expos-abstractions/ class=md-nav__link> eXpOS Abstractions </a> </li> <li class=md-nav__item> <a href=../../os-spec/expfs/ class=md-nav__link> The Logical File System eXpFS </a> </li> <li class=md-nav__item> <a href=../../os-spec/processmodel/ class=md-nav__link> Process Model </a> </li> <li class=md-nav__item> <a href=../../os-spec/synchronization/ class=md-nav__link> Synchronization and Access Control </a> </li> <li class=md-nav__item> <a href=../../os-spec/misc/ class=md-nav__link> Micellaneous </a> </li> <li class=md-nav__item> <a href=../../os-spec/multiuser/ class=md-nav__link> Multi-User Extension to eXpOS </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_1_9 type=checkbox id=__nav_2_2_1_9> <label class=md-nav__link for=__nav_2_2_1_9> Application Programmer's Interface (API) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Programmer's Interface (API)" data-md-level=4> <label class=md-nav__title for=__nav_2_2_1_9> <span class="md-nav__icon md-icon"></span> Application Programmer's Interface (API) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../os-spec/systemcallinterface/ class=md-nav__link> High Level System Call Interface </a> </li> <li class=md-nav__item> <a href=../../os-spec/dynamicmemoryroutines/ class=md-nav__link> High Level Library Interface </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../os-spec/shell-spec/ class=md-nav__link> eXpOS Shell Specification </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_2 type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2> Design <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Design data-md-level=3> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> Design </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../os-design/ class=md-nav__link> Design </a> </li> <li class=md-nav__item> <a href=../../os-design/misc/ class=md-nav__link> Micellaneous </a> </li> <li class=md-nav__item> <a href=../../os-design/exe-handler/ class=md-nav__link> Exception Handler </a> </li> <li class=md-nav__item> <a href=../../os-design/timer/ class=md-nav__link> Timer </a> </li> <li class=md-nav__item> <a href=../../os-design/disk-interrupt/ class=md-nav__link> Disk Interrupt Handler </a> </li> <li class=md-nav__item> <a href=../../os-design/term-handler/ class=md-nav__link> Terminal Interrupt Handler </a> </li> <li class=md-nav__item> <a href=../../os-design/shutdown/ class=md-nav__link> Shutdown </a> </li> <li class=md-nav__item> <a href=../../os-design/create/ class=md-nav__link> Create </a> </li> <li class=md-nav__item> <a href=../../os-design/delete/ class=md-nav__link> Delete </a> </li> <li class=md-nav__item> <a href=../../os-design/open/ class=md-nav__link> Open </a> </li> <li class=md-nav__item> <a href=../../os-design/close/ class=md-nav__link> Close </a> </li> <li class=md-nav__item> <a href=../../os-design/read/ class=md-nav__link> Read </a> </li> <li class=md-nav__item> <a href=../../os-design/write/ class=md-nav__link> Write </a> </li> <li class=md-nav__item> <a href=../../os-design/seek/ class=md-nav__link> Seek </a> </li> <li class=md-nav__item> <a href=../../os-design/fork/ class=md-nav__link> Fork </a> </li> <li class=md-nav__item> <a href=../../os-design/exec/ class=md-nav__link> Exec </a> </li> <li class=md-nav__item> <a href=../../os-design/exit/ class=md-nav__link> Exit </a> </li> <li class=md-nav__item> <a href=../../os-design/proc-misc/ class=md-nav__link> Process Micellaneous </a> </li> <li class=md-nav__item> <a href=../../os-design/synchronization-algos/ class=md-nav__link> Synchronization Algorithms </a> </li> <li class=md-nav__item> <a href=../../os-design/semaphore-algos/ class=md-nav__link> Semaphore Algorithms </a> </li> <li class=md-nav__item> <a href=../../os-design/multiusersyscalls/ class=md-nav__link> Multi-User System Calls </a> </li> <li class=md-nav__item> <a href=../../os-design/disk-ds/ class=md-nav__link> Disk Data Structures </a> </li> <li class=md-nav__item> <a href=../../os-design/process-table/ class=md-nav__link> Process Table </a> </li> <li class=md-nav__item> <a href=../../os-design/mem-ds/ class=md-nav__link> Memory Data Structures </a> </li> <li class=md-nav__item> <a href=../../os-design/state-diag/ class=md-nav__link> Process State Diagram </a> </li> <li class=md-nav__item> <a href=../../os-design/nexpos/ class=md-nav__link> NeXpOS Design </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_3 type=checkbox id=__nav_2_2_3> <label class=md-nav__link for=__nav_2_2_3> Implementation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Implementation data-md-level=3> <label class=md-nav__title for=__nav_2_2_3> <span class="md-nav__icon md-icon"></span> Implementation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../os-implementation/ class=md-nav__link> Implementation </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2_3_2 type=checkbox id=__nav_2_2_3_2> <label class=md-nav__link for=__nav_2_2_3_2> Kernel Stack Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kernel Stack Management" data-md-level=4> <label class=md-nav__title for=__nav_2_2_3_2> <span class="md-nav__icon md-icon"></span> Kernel Stack Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../os-design/stack-smcall/ class=md-nav__link> During System Calls </a> </li> <li class=md-nav__item> <a href=../../os-design/stack-interrupt/ class=md-nav__link> During Hardware interrupts or exceptions </a> </li> <li class=md-nav__item> <a href=../../os-design/stack-module/ class=md-nav__link> During Module calls </a> </li> <li class=md-nav__item> <a href=../../os-design/timer-stack-management/ class=md-nav__link> During Context Switch </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3> Architecture <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Architecture data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_1 type=checkbox id=__nav_2_3_1> <label class=md-nav__link for=__nav_2_3_1> Specification <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Specification data-md-level=3> <label class=md-nav__title for=__nav_2_3_1> <span class="md-nav__icon md-icon"></span> Specification </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../arch-spec/ class=md-nav__link> XSM Architecture Specifcation </a> </li> <li class=md-nav__item> <a href=../../virtual-machine-spec/ class=md-nav__link> Virtual Machine Model </a> </li> <li class=md-nav__item> <a href=../../arch-spec/machine-organization/ class=md-nav__link> Machine Organisation </a> </li> <li class=md-nav__item> <a href=../../arch-spec/interrupts-exception-handling/ class=md-nav__link> Interrupts and Exception Handling </a> </li> <li class=md-nav__item> <a href=../../arch-spec/instruction-set/ class=md-nav__link> Instruction Set </a> </li> <li class=md-nav__item> <a href=../../arch-spec/paging-hardware/ class=md-nav__link> Paging Hardware and Address Translation </a> </li> <li class=md-nav__item> <a href=../../arch-spec/nexsm/ class=md-nav__link> NEXSM (Two Core) Architecture Specification </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_2 type=checkbox id=__nav_2_3_2> <label class=md-nav__link for=__nav_2_3_2> Modules <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Modules data-md-level=3> <label class=md-nav__title for=__nav_2_3_2> <span class="md-nav__icon md-icon"></span> Modules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../../modules/module-00/ class=md-nav__link> Module 0 </a> </li> <li class=md-nav__item> <a href=../../modules/module-01/ class=md-nav__link> Module 1 </a> </li> <li class=md-nav__item> <a href=../../modules/module-02/ class=md-nav__link> Module 2 </a> </li> <li class=md-nav__item> <a href=../../modules/module-03/ class=md-nav__link> Module 3 </a> </li> <li class=md-nav__item> <a href=../../modules/module-04/ class=md-nav__link> Module 4 </a> </li> <li class=md-nav__item> <a href=../../modules/module-05/ class=md-nav__link> Module 5 </a> </li> <li class=md-nav__item> <a href=../../modules/module-06/ class=md-nav__link> Module 6 </a> </li> <li class=md-nav__item> <a href=../../modules/module-07/ class=md-nav__link> Module 7 </a> </li> <li class=md-nav__item> <a href=../../modules/module-08/ class=md-nav__link> Module 8 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_3 type=checkbox id=__nav_2_3_3 checked> <label class=md-nav__link for=__nav_2_3_3> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=3> <label class=md-nav__title for=__nav_2_3_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../multiuser-implementation/ class=md-nav__link> MultiUser Implementation </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> FileSystem Implementation <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> FileSystem Implementation </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#disk-data-structures class=md-nav__link> Disk Data structures </a> <nav class=md-nav aria-label="Disk Data structures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-disk-blocks-and-disk-free-list class=md-nav__link> 1. Disk blocks and Disk Free List </a> </li> <li class=md-nav__item> <a href=#2-inode-table class=md-nav__link> 2. Inode Table </a> </li> <li class=md-nav__item> <a href=#3-root-file class=md-nav__link> 3. Root File </a> </li> <li class=md-nav__item> <a href=#4-user-table class=md-nav__link> 4. User Table </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#transient-data-structures class=md-nav__link> Transient data structures </a> <nav class=md-nav aria-label="Transient data structures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-file-inode-status-table class=md-nav__link> 1. File (Inode) Status Table </a> </li> <li class=md-nav__item> <a href=#2-open-file-table class=md-nav__link> 2. Open File Table </a> </li> <li class=md-nav__item> <a href=#3-per-process-resource-table class=md-nav__link> 3. Per-Process Resource Table </a> </li> <li class=md-nav__item> <a href=#4-memory-buffer-cache class=md-nav__link> 4.​ ​ Memory buffer Cache </a> </li> <li class=md-nav__item> <a href=#5-buffer-table class=md-nav__link> 5.​ ​ Buffer Table </a> </li> <li class=md-nav__item> <a href=#6-in-memory-copy-of-disk-data-structures class=md-nav__link> 6.​ In-Memory Copy of Disk data structures </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../process-management-implementation/ class=md-nav__link> Process Management Implementation </a> </li> <li class=md-nav__item> <a href=../xsm-instruction-cycle/ class=md-nav__link> XSM Instruction Cycle </a> </li> <li class=md-nav__item> <a href=../xsm-interrupts-tutorial/ class=md-nav__link> XSM Interrupts tutorial </a> </li> <li class=md-nav__item> <a href=../xsm-unprivileged-tutorial/ class=md-nav__link> XSM Unprivileged tutorial </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_4 type=checkbox id=__nav_2_3_4> <label class=md-nav__link for=__nav_2_3_4> Support Tools <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Support Tools" data-md-level=3> <label class=md-nav__title for=__nav_2_3_4> <span class="md-nav__icon md-icon"></span> Support Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../support-tools/setting-up/ class=md-nav__link> Setting up </a> </li> <li class=md-nav__item> <a href=../../support-tools/docker-setup/ class=md-nav__link> Docker based setup </a> </li> <li class=md-nav__item> <a href=../../support-tools/xfs-interface/ class=md-nav__link> XFS Interface </a> </li> <li class=md-nav__item> <a href=../../support-tools/spl/ class=md-nav__link> SPL </a> </li> <li class=md-nav__item> <a href=../../support-tools/expl/ class=md-nav__link> ExpL </a> </li> <li class=md-nav__item> <a href=../../support-tools/xsm-simulator/ class=md-nav__link> XSM Simulator </a> </li> <li class=md-nav__item> <a href=../../support-tools/constants/ class=md-nav__link> Constants </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3_5 type=checkbox id=__nav_2_3_5> <label class=md-nav__link for=__nav_2_3_5> Application Interface <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Application Interface" data-md-level=3> <label class=md-nav__title for=__nav_2_3_5> <span class="md-nav__icon md-icon"></span> Application Interface </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../abi/ class=md-nav__link> Application Binary Interface (ABI) </a> </li> <li class=md-nav__item> <a href=../../os-design/sw-interface/ class=md-nav__link> Low Level System Call Interface </a> </li> <li class=md-nav__item> <a href=../../os-spec/dynamicmemoryroutines/ class=md-nav__link> High Level Library Interface </a> </li> <li class=md-nav__item> <a href=../../abi/ class=md-nav__link> Low Level Library Interface </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4 type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4> Others <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Others data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Others </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_4_1 type=checkbox id=__nav_2_4_1> <label class=md-nav__link for=__nav_2_4_1> Test Programs <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Test Programs" data-md-level=3> <label class=md-nav__title for=__nav_2_4_1> <span class="md-nav__icon md-icon"></span> Test Programs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../test-programs/ class=md-nav__link> Test Programs </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-01/ class=md-nav__link> Program 1 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-02/ class=md-nav__link> Program 2 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-03/ class=md-nav__link> Program 3 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-04/ class=md-nav__link> Program 4 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-05/ class=md-nav__link> Program 5 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-06/ class=md-nav__link> Program 6 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-07/ class=md-nav__link> Program 7 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-08/ class=md-nav__link> Program 8 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-09/ class=md-nav__link> Program 9 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-10/ class=md-nav__link> Program 10 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-11/ class=md-nav__link> Program 11 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-12/ class=md-nav__link> Program 12 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-13/ class=md-nav__link> Program 13 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-14/ class=md-nav__link> Program 14 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-15/ class=md-nav__link> Program 15 </a> </li> <li class=md-nav__item> <a href=../../test-programs/test-program-16/ class=md-nav__link> Program 16 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Roadmap <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Roadmap data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roadmap/ class=md-nav__link> Roadmap </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2> Preparatory Stages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Preparatory Stages" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Preparatory Stages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roadmap/stage-01/ class=md-nav__link> Stage 1 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-02/ class=md-nav__link> Stage 2 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-03/ class=md-nav__link> Stage 3 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-04/ class=md-nav__link> Stage 4 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-05/ class=md-nav__link> Stage 5 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-06/ class=md-nav__link> Stage 6 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-07/ class=md-nav__link> Stage 7 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-08/ class=md-nav__link> Stage 8 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-09/ class=md-nav__link> Stage 9 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-10/ class=md-nav__link> Stage 10 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-11/ class=md-nav__link> Stage 11 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-12/ class=md-nav__link> Stage 12 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3> Intermediate Stages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Intermediate Stages" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Intermediate Stages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roadmap/stage-13/ class=md-nav__link> Stage 13 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-14/ class=md-nav__link> Stage 14 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-15/ class=md-nav__link> Stage 15 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-16/ class=md-nav__link> Stage 16 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-17/ class=md-nav__link> Stage 17 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-18/ class=md-nav__link> Stage 18 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-19/ class=md-nav__link> Stage 19 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Final Stages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Final Stages" data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Final Stages </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roadmap/stage-20/ class=md-nav__link> Stage 20 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-21/ class=md-nav__link> Stage 21 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-22/ class=md-nav__link> Stage 22 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-23/ class=md-nav__link> Stage 23 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-24/ class=md-nav__link> Stage 24 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-25/ class=md-nav__link> Stage 25 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-26/ class=md-nav__link> Stage 26 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-27/ class=md-nav__link> Stage 27 </a> </li> <li class=md-nav__item> <a href=../../roadmap/stage-28/ class=md-nav__link> Stage 28 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Student Feedback <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Student Feedback" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Student Feedback </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../feedback/ class=md-nav__link> Student Feedback </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc21/ class=md-nav__link> NIT-C 2021 </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc20/ class=md-nav__link> NIT-C 2020 </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc19/ class=md-nav__link> NIT-C 2019 </a> </li> <li class=md-nav__item> <a href=../../feedback/iitpkd18/ class=md-nav__link> IIT PKD 2018 </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc18/ class=md-nav__link> NIT-C 2018 </a> </li> <li class=md-nav__item> <a href=../../feedback/analysis/ class=md-nav__link> Analysis of Student Feedback </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://exposnitc.github.io/user-contrib/ target=_blank class=md-nav__link> User Contributions </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> About <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> Changelog </a> </li> <li class=md-nav__item> <a href=../../reports/ class=md-nav__link> Project Reports </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=http://xosnitc.github.io target=_blank class=md-nav__link> XOS </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#disk-data-structures class=md-nav__link> Disk Data structures </a> <nav class=md-nav aria-label="Disk Data structures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-disk-blocks-and-disk-free-list class=md-nav__link> 1. Disk blocks and Disk Free List </a> </li> <li class=md-nav__item> <a href=#2-inode-table class=md-nav__link> 2. Inode Table </a> </li> <li class=md-nav__item> <a href=#3-root-file class=md-nav__link> 3. Root File </a> </li> <li class=md-nav__item> <a href=#4-user-table class=md-nav__link> 4. User Table </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#transient-data-structures class=md-nav__link> Transient data structures </a> <nav class=md-nav aria-label="Transient data structures"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-file-inode-status-table class=md-nav__link> 1. File (Inode) Status Table </a> </li> <li class=md-nav__item> <a href=#2-open-file-table class=md-nav__link> 2. Open File Table </a> </li> <li class=md-nav__item> <a href=#3-per-process-resource-table class=md-nav__link> 3. Per-Process Resource Table </a> </li> <li class=md-nav__item> <a href=#4-memory-buffer-cache class=md-nav__link> 4.​ ​ Memory buffer Cache </a> </li> <li class=md-nav__item> <a href=#5-buffer-table class=md-nav__link> 5.​ ​ Buffer Table </a> </li> <li class=md-nav__item> <a href=#6-in-memory-copy-of-disk-data-structures class=md-nav__link> 6.​ In-Memory Copy of Disk data structures </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <!-- Edit button --> <a href=https://github.com/eXpOSNitc/expos-docs/edit/main/docs/tutorials/filesystem-implementation.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <!--
    Hack: check whether the content contains a h1 headline. If it
    doesn't, the page title (or respectively site name) is used
    as the main headline.
    --> <h1>eXpOS File system and Implementation Tutorial</h1> <!-- Markdown content --> <div class="admonition note"> <p class=admonition-title>Prerequisites</p> <p>It is necessary to read the following documentations before starting with this tutorial.</p> <ol> <li>User level view of <a href=../../os-spec/expfs/ >eXpFS file system</a>. </li> <li><a href=../../os-spec/systemcallinterface/#file-system-calls>Program level interface</a> to different file system calls. </li> <li>Read about <a href=../../os-spec/multiuser/#file-access-permissions>file permissions</a>.</li> </ol> </div> <p>To implement the file system, one needs to understand the file system data structures that the OS maintains. One should also understand how various file system routines of the OS access and update these data structures.</p> <hr> <h3 id=disk-data-structures>Disk Data structures<a class=headerlink href=#disk-data-structures title="Permanent link">&para;</a></h3> <p>There are two categories of file data structures. The first category consists of data that remains in the disk even when the machine is shut down (disk data structures​). These are described first:</p> <h4 id=1-disk-blocks-and-disk-free-list>1. Disk blocks and Disk Free List<a class=headerlink href=#1-disk-blocks-and-disk-free-list title="Permanent link">&para;</a></h4> <p>The​ ​data of a file is stored in disk blocks. A file may have up to 4 blocks of data. The OS provides the user with an interface where the user feels that the file is sequentially stored although the actual allocation could be in non-contiguous disk blocks. The Inode table entry (described next) for a file stores the block numbers of the disk blocks which contain the file data. The ​<a href=../../os-design/disk-ds/#disk-free-list>disk free list</a>​ is a global disk data structure that indicates which disk blocks are allocated and which disk blocks are free. Disk blocks are allocated for a file by the <a href=../../os-spec/systemcallinterface/#file-system-calls><em>Write</em> ​system call</a>. When a user program issues a write request, the system call allocates new blocks whenever necessary. (In more detail, the ​ <em>Write</em> ​system call routine invokes the ​<strong>Get Free Block</strong> ​function of the ​<a href=../../modules/module-02/ >Memory Manager Module</a> to allocate a disk block.) Disk blocks associated with a file are de-allocated when the file is removed from the file system by the ​<a href=../../os-spec/systemcallinterface/#file-system-calls><em>Delete</em> ​system call</a> (by invoking the ​<strong>Release Block</strong> ​function of the ​<a href=../../modules/module-02/ >Memory Manager Module</a>.) Whenever blocks are allocated/released, the disk free list is also updated to indicate the allocation status. The following disk data structures contain ​<strong>meta-data</strong> ​corresponding to each file in the system. Inode table​ ​and the root file are data structures of this kind. </p> <h4 id=2-inode-table>2. Inode Table<a class=headerlink href=#2-inode-table title="Permanent link">&para;</a></h4> <p><a href=../../os-design/disk-ds/#inode-table>Inode table</a> is a global data structure that contains an entry for each file stored in the file system. When a file is created using the ​<a href=../../os-spec/systemcallinterface/#file-system-calls><em>Create</em> ​system call</a> or loaded into the disk using XFS-interface, a new Inode entry is created for the file. The inode entry of a file stores the following attributes of the file: 1) filename, 2) file size, 3) user-id of the owner of the file, 4) file type (data/executable/root), 5) file access permissions and 6) the block numbers of the disk blocks allocated to a file (maximum four blocks).</p> <p>When a file is created by the ​<em>Create</em> ​system call, no disk blocks are allocated for the file, and only an Inode entry is created. Hence the file size will be set to 0 initially. Filename and access permissions are supplied as arguments to ​<em>Create</em> ​system call and are set accordingly. eXpOS allows only data files to be created using ​<em>Create</em> ​system call. Hence, the file type of any file created using the <em>Create</em> system call will be set to DATA. (Executable files can only be externally loaded into the file system using ​ xfs-interface). The user-id of the process executing <em>Create</em> ​system call will set as the owner of the file. (The user-id of a process is the user-id of the user logged into the system currently. eXpOS is a ​<strong>single terminal system</strong>.​ Only one user can login into the system at a time and run user processes).</p> <p>As noted previously, as data is written into the file by the ​<em>Write</em> ​system call, new disk blocks may be allocated. Whenever a block is allocated for a file, the block number is recorded in the Inode table.</p> <p>A file can be created with ​<a href=../../support-tools/constants/ >Exclusive Access</a> / <a href=../../support-tools/constants/ >Open Access</a> permission. The access permission is given as an argument to ​<em>Create</em>​ system call. If a file is created with exclusive access, the ​<em>Delete</em> and ​<em>Write</em>​ system calls must fail if executed by any process whose user-id is not equal to root, or the owner of the file. In other words, other users except the root shall not be permitted to modify or delete such files. When a file has open access permission, all users are allowed to perform any operation on the file.</p> <h4 id=3-root-file>3. Root File<a class=headerlink href=#3-root-file title="Permanent link">&para;</a></h4> <p>The <a href=../../os-design/disk-ds/#root-file>root file</a> stores human readable information about each file in the file system. The eXpFS file system does not support a hierarchical directory structure and all files are listed at a single level. Each file has an entry in the ​<strong>root file</strong>. The kth entry in the root file corresponds to the file whose index in the Inode table is k. The root file entry for a file contains filename, file size, file-type, user-name and access permissions. Thus, part of the the data in the Inode table is duplicated in the root file. The reason for this duplication is that root file is designed to be readable by user programs using the ​<em>Read</em> ​system call (unlike the inode table, which is accessed exclusively by OS routines only). An application readable root file allows implementation of commands like “ls” (see <a href=https://en.wikipedia.org/wiki/Ls>Unix command “ls”</a>) as user mode programs. <em>Write</em> ​and ​<em>Delete</em> system calls are not permitted on the root file.</p> <p>The only data in the root file entry of a file that is not present in the inode table is the user name of the owner of the file. The inode table entry of a file contains a user-id of the owner. The user-id value can be used to index into the user table (described below) to find the username corresponding to the user-id.</p> <p>When a file is created, the <em>Create</em> system call must initialize the root file entries of the file along with the Inode table entries. Similarly, when the file size is changed in the Inode table by a write to the file (in the ​<em>Write</em>​ system call), the file size value in the root file also needs to be updated.</p> <h4 id=4-user-table>4. User Table<a class=headerlink href=#4-user-table title="Permanent link">&para;</a></h4> <p><a href=../../os-design/disk-ds/#user-table>User table</a> contains the names of each user who has an account in the system. Though user table is not a data structure associated with the file system, one needs to understand a little bit about this data structure for the file system implementation. The details of how and when user table entries are created are not relevant to the file system implementation.</p> <p>For the present purpose, it suffices to understand that each user has an entry in the user table. The entry for a user in the user table consists of a) username and b) encrypted password. The OS assigns a ​<em>user-id</em>​ to each user. ​<strong>The user-id of a user is the index of the user’s entry in the user table.​</strong> The first two entries of the table (corresponding to user-id 0 and 1) are reserved for special users ​<em>kernel</em> and​ <em>root</em>​.</p> <p>When a process executes the ​<em>Create</em>​ system call to create a file, ​<em>Create</em> system call looks up the process table entry of the calling process to find the user-id of the process executing ​<em>Create</em> and sets the user-id field in the Inode table. The system call then looks up the user table entry corresponding to the user-id and finds out the username and sets the user name field in the root file entry created for the file.</p> <hr> <h3 id=transient-data-structures>Transient data structures<a class=headerlink href=#transient-data-structures title="Permanent link">&para;</a></h3> <p>The second category of data structures are transient - they are "alive" only when the OS is running (in-memory data structures). These data structures are described below:</p> <p>When the OS is running, user processes can Open/Read/Write an already created file. ​<strong>When a file is opened by a process using the ​<em>Open</em> system call, a new “open instance” is created.</strong> The OS keeps track of the number of open instances of a file at all times. If a file is opened multiple times (by the same or a different process), each ​<em>Open</em>​ call results in creation of a fresh open instance.</p> <p>Associated with each open instance​ ​of a file, there is a ​<strong>seek pointer</strong>​, which is initialized to the beginning of the file (value 0) by the ​<em>Open</em>​ system call. Whenever the file is read from/written into, the update is done to the position in the file corresponding to the seek value, and the seek value is incremented. ​<strong>If a process opens a file and subsequently invokes the ​<em>Fork</em> system call, the seek pointer is shared between the parent and the child.</strong> Hence, subsequent to the fork, if either the parent or the child executes ​<em>Read</em>/<em>Write</em>​ system call on the open instance, their common shared seek pointer advances. Finally, the (shared) seek pointer value can be modified (by either process) using the ​<em>Seek</em> system call. This is the mechanism through which the OS allows multiple processes to share access to a file.</p> <p>Suppose a process closes an open instance using the ​<em>Close</em>​ system call, the ​<em>Close</em>​ system call first checks whether the open instance is shared by other (child/parent/sibling) processes. In that case, the OS simply decrements the “share count” of the open instance. If the last process that shared an open instance closes the file, then the share count reaches zero and the open instance is closed.</p> <p>To implement this somewhat intricate file access and sharing mechanism, the OS maintains two global file data structures - the ​<strong>file status table</strong>​ (also called the inode status table), and the <strong>open file table</strong>​. Moreover, for each process the OS maintains a ​<strong>per-process resource table​</strong>, which contains information pertaining to the open instances of files of the particular process.</p> <p>The OS further maintains a ​<strong>buffer cache​</strong> which is used for caching data blocks of files in current use. A ​<strong>buffer table</strong>​ is used to manage the data related to the buffer cache. These data structures are described below. Read the description of <a href=../../os-design/mem-ds/ >open file table</a> and <a href=../../os-design/mem-ds/#file-inode-status-table>file status table</a> before reading further.</p> <h4 id=1-file-inode-status-table>1. File (Inode) Status Table<a class=headerlink href=#1-file-inode-status-table title="Permanent link">&para;</a></h4> <p>File (Inode) status table contains an entry for each file in the file system. The index of a file’s Inode table entry and file status table entry will be the same. That is, if a file’s entry occurs - say - 10th in the inode table, its entry in the file (inode) status table will be the 10th one as well. The purpose of the table is two-fold 1) To keep track of how many times each file has been opened using the ​ open ​ system call. 2) To provide a mechanism for processes to ​<strong>lock</strong> a file before making updates to the file’s data/metadata.</p> <p>Every time a file is opened by (any) process using the ​<em>Open</em>​ system call, the ​<strong>file open count</strong> field in the corresponding file status table entry is incremented. Thus, the table gives the global count of the number of open instances of a file.</p> <p>Second, when a process enters a file system call and tries to access a file, the system call code must first lock access to the file to ensure that till the system call is completed, no other process is allowed to execute any file system call that accesses the file’s data/metadata. This is necessary to ensure safety under concurrent execution. The system call locks the file by setting locking-PID field of the file status table to the PID of the process executing the system call. Upon completion of the system call, the system call code must unlock the file before returning to user mode. The ​<strong>Acquire Inode</strong> and <strong>Release Inode</strong> ​functions of the ​<a href=../../modules/module-00/ >Resource Manager Module</a> are designed to handle file access regulation (locking).</p> <p>The SPL constant <a href=../../support-tools/constants/ >FILE_STATUS_TABLE</a> is set to the beginning address of the file status table in memory (see <a href=../../os-implementation/ >memory organization</a>).</p> <h4 id=2-open-file-table>2. Open File Table<a class=headerlink href=#2-open-file-table title="Permanent link">&para;</a></h4> <p>As noted earlier, If a process opens a file using the ​<em>Open</em>​ system call and subsequently execute a ​<em>Fork</em>​ system call, the open instance of the file is shared between the parent and the child. If the child (or the parent) further execute ​<em>fork</em>, more processes will share the same open instance. Hence, there must be a mechanism to keep track of the count of processes sharing the same open instance of a file. Open file table is the data structure which keeps track of this count.</p> <p>Whenever a file is opened by a process, an open file table entry is created for the open instance. The entry contains three fields:<br> a)​ The index of the inode table of the file.<br> b​) The count of the number of processes sharing the open instance, which will be set to 1 when the file is opened as only one process is sharing the open instance. When the process executes a ​<em>Fork</em>​ system call, the share count is incremented to reflect the correct number of processes sharing the open instance. (Note: Do not confuse this count with the file open count in the file status table.)<br> c)​ The seek pointer for the open instance is stored in the open file table. Any read/write operation on this open instance must read from / write into this position of the file and advance the pointer. When a file is opened, the seek position is set to 0. Note that the seek pointer is shared between all processes sharing the open instance.</p> <p>The SPL constant <a href=../../support-tools/constants/ >OPEN_FILE_TABLE</a> is set to the beginning address of the open file table in memory (see <a href=../../os-implementation/ >memory organization</a>).</p> <p>When a process executes a ​<em>Read</em>/<em>Write</em>​ system call on an open instance, the system call handler, along with the data read/write operation on the file, advances the seek pointer in the open file table entry corresponding to the open instance.</p> <h4 id=3-per-process-resource-table>3. Per-Process Resource Table<a class=headerlink href=#3-per-process-resource-table title="Permanent link">&para;</a></h4> <p>When a process opens a file, a new entry is created for the open instance in the <a href=../../os-design/process-table/#per-process-resource-table>per process resource table</a> of the process.<br> This entry contains two fields:<br> a)​ A flag indicating whether the entry corresponds to a file or a semaphore.<br> b)​ Index of the open file table /semaphore table entry of the open file / semaphore instance.<br> Here we will be concerned only about the case when the entry corresponds to an open file.</p> <p>The ​<em>Open</em> system call returns the index of an entry in the resource table as the <strong>file descriptor</strong> to the user. Any ​<em>Read</em>/<em>Write</em>/<em>Seek</em>/<em>Close</em>​ system call on the open instance of a file must be given this file descriptor as the argument. ​<em>Read</em>/<em>Write</em>/<em>Seek</em>/<em>Close</em>​ system calls use the descriptor value passed as argument to identify the open instance (determined uniquely by the open file table index associated with the file descriptor). When a process forks a child, <em>Fork</em> system call copies the entries of the resource table of the parent to the resource table of the child. Thus, the child inherits the open instances of files from the parent.</p> <p>As an example, consider the following scenario. Let process B be a child of process A. Assume that an open instance of a file by name <em>myfile.dat</em> be shared by A and B. Suppose the inode index of <em>myfile.dat</em> is 5. Assume that the open file table index for the open instance is - say 2. The following figure shows the various table entries for the open instance.</p> <p><img alt src=../../assets/img/tutorials/file_system.png></p> <p>File data structures entries in the above scenario</p> <p>In addition to the above data structures, the OS maintains the following global data structures:</p> <h4 id=4-memory-buffer-cache>4.​ ​ Memory buffer Cache<a class=headerlink href=#4-memory-buffer-cache title="Permanent link">&para;</a></h4> <p>Whenever a process tries to ​<em>Read</em>/<em>Write</em>​ into a file, the relevant block of the file is first brought into a disk buffer in memory and the read/write is performed on the copy of the block stored in the buffer. The OS maintains 4 memory buffer pages as cache (and will be numbered 0,1,2,3. The buffers are in memory pages 71, 72, 73, 74 - see <a href=../../os-implementation/ >memory organization</a>). A simple buffering scheme will be used here. When there is a request for the ith disk block, it will be brought to the buffer with number (<em>i mod 4</em>). If the buffer is presently containing another disk block, then the OS must check whether the disk block needs a write-back (dirty) before loading the requested block. This will be described soon.</p> <h4 id=5-buffer-table>5.​ ​ Buffer Table<a class=headerlink href=#5-buffer-table title="Permanent link">&para;</a></h4> <p>The buffer table is used for managing the buffer cache. The table contains one entry per each buffer page. The entry for a buffer contains:<br> a) ​The block number of the disk block currently stored in the buffer page. If the buffer is unallocated, the disk block number is set to -1.<br> b​) A flag indicating whether the block was modified after loading (dirty).<br> c) ​The PID of the process that has locked the buffer page. (-1 if no process has locked the buffer.)</p> <p>The locking PID field requires some explanation. When a process tries to do read/write into certain data block of a file using ​<em>Read</em>/<em>Write</em> system call, the system call must first determine the buffer number to which the block must be loaded (using the formula indicated above) and lock the buffer before initiating disk to buffer data transfer. This is to prevent other processes from concurrently trying to load other blocks into the same buffer page.</p> <p>To understand the dynamics of how file system calls operate with the above data structures, let us consider an example. Suppose a process executes a ​<em>Write</em>​ into the open instance of a file. The <em>Write</em> system call uses the file descriptor (received as input argument) to find the index of the open file table entry corresponding to the descriptor. From the open file table entry, ​<em>Write</em> gets the seek pointer (using open file table) and index of the the inode table entry for the file. Next it locks the Inode (using ​<strong>Acquire Inode</strong>​ function of the ​<a href=../../modules/module-00/ >Resource Manager Module</a>). It then determines the disk block to which data must be written (using the seek position and the Inode table entry of the file). Now, <em>Write</em> invokes the ​<strong>Buffered Write</strong> function of ​<a href=../../modules/module-03/ >File Manager Module</a> to perform the write.</p> <p><strong>Buffered Write</strong> first calculates the buffer number corresponding to the block number and locks the buffer (invoking the ​<strong>Acquire Buffer</strong>​ function of the ​<a href=../../modules/module-00/ >Resource Manager Module</a>). It then checks whether the disk block to be written into is already present in the buffer. If not, the disk block has to be loaded first into the buffer. However, if the buffer is currently containing another disk block and if the disk block is dirty, then the disk block must be written back first. The buffer table entry for the buffer will help ​<em>Buffered Write</em> to determine whether the buffer is free, or if not free whether write back is required. Write Back is performed using the ​<strong>Disk Store</strong> function of the ​<a href=../../modules/module-04/ >Device Manager Module</a>. (​<em>Disk Store</em> function makes another resource lock - calls the ​<strong>Acquire Disk</strong> function of the ​<a href=../../modules/module-00/ >Resource Manager Module</a> before disk commit is done).</p> <p>Finally, after getting the buffer page free for use, ​<em>Buffered Write</em>​ brings the required disk block into the buffer page using the ​<strong>Disk Load</strong> function of the ​<a href=../../modules/module-04/ >Device Manager Module</a>. Now Buffered Write can write the data into the buffer. Since the contents of the block has been modified, Buffered Write sets the ​<strong>dirty bit</strong>​ in the buffer table entry for the buffer. Note that <em>Write</em>​ does not​ ​store the modified buffer back to the disk. The modifications are committed only when a subsequent write operation requires the buffer to be loaded with a different disk block. The OS also commits back all dirty buffers to the disk before shutdown.</p> <p>A ​<em>Read</em> operation is similar, except that the ​<strong>dirty bit is not set</strong>​ as the page is not modified.</p> <p>The execution of ​<em>Read</em>/<em>Write</em>​ system calls involves a sequence of resource acquisitions - namely inode, buffer and disk. The resources are acquired in the order Inode-buffer-disk and must be released in the reverse order when the actions are completed. This avoids circular wait - a sufficient condition for <a href=https://en.wikipedia.org/wiki/Deadlock>deadlock</a> prevention.</p> <h4 id=6-in-memory-copy-of-disk-data-structures>6.​ In-Memory Copy of Disk data structures<a class=headerlink href=#6-in-memory-copy-of-disk-data-structures title="Permanent link">&para;</a></h4> <p>Finally, the OS maintains an in-memory copy of all the disk data structures - viz., inode table, user table, root file and the disk free list. While the OS is running, a new user could be created or a file could be created/modified/deleted. In such cases, the update is made into the memory copy of the corresponding data structures and not the disk copy.</p> <p>The OS must write back the memory copy of all disk data structures and all dirty buffers to the disk before the system is shutdown. The file system implementation described here is ​<strong>not crash resilient</strong>​. This means, if the OS crashes before (or during) such write back, the memory-copy to disk updates may be partial and the disk data structures may end up in inconsistent state. In such case, one or more files may be corrupted and the disk may require reformatting.</p> <!-- Last update of source file --> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../multiuser-implementation/ class="md-footer__link md-footer__link--prev" aria-label="Previous: MultiUser Implementation" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> MultiUser Implementation </div> </div> </a> <a href=../process-management-implementation/ class="md-footer__link md-footer__link--next" aria-label="Next: Process Management Implementation" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Process Management Implementation </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> National Insititute of Technology, Calicut <br> <a href=https://creativecommons.org/licenses/by-nc/4.0/ rel=license> <img alt="Creative Commons License" style=border-width:0 src=https://licensebuttons.net/l/by-nc/4.0/80x15.png> </a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/exposnitc target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://groups.google.com/g/xos-users target=_blank rel=noopener title=groups.google.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 488 512"><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.ddd52ceb.min.js></script> </body> </html>